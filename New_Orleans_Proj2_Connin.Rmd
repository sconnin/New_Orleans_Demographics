---
title: "Proj_2New_Orleans"
author: "Sean Connin"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rvest)
library(tidyverse)
library(magrittr)
library(ggplot2)
library(corrplot)


```

## 1. Wikipedia Tables: Overview

In this section we explore patterns of recorded hurricane activity from 1900 -to- present in the Atlantic Ocean, Gulf of Mexico and Caribbean Sea. Our goal was to address the following questions:

1. Are there long-term trends in season hurricane activity that are apparent across broad geographic areas?
2. Do cumulative measures of storm intensity correlate with storm related deaths or property damage? 
3. Was 2005 hurricane season, which included Hurricane Katrina, atypical in terms of total storm activity?

The data used in our analysis can be obtained via. NOAA's "North Atlantic hurricane Database (HURDAT)". However, we extracted the information from 20 html tables listed on the Wikipedia page, "Atlantic hurricane season". 

Steps taken to format the data for analysis in R (i.e., Tidy format) included: 1) importing the data into RStudio as a list of dataframes (each representing different periods of time); 2) iterating over this list to subset, filter, rename, and update column types; and 3) combining these elements (20 total) into a final dataframe. 

Additional cleaning was required to address uncertainties inherent to values recorded for several variables. For example, storm related deaths included values (char type) input as "Unknown", single numbers, approximate values, and/or a range of values. We converted this information to integer type and limited values to the minimum number of known deaths - values included as "Unknown" were treated as missing (NA) in order to make quantitative comparisons to other variables. We applied similar steps to a variable for annual storm damage. 

Once in Tidy form, we exported the dataset to an external .csv file. We then proceeded with our analyses. 

The following code documents the steps described above to import, clean, analyze, and export our data. This is followed by our summary for this section.

```{r}

# import Wikipedia data tables into a list of dataframes

temp <- read_html('https://en.wikipedia.org/wiki/Atlantic_hurricane_season')
storms <- temp %>%
  html_nodes("table") %>%
  html_table(fill = TRUE)

# Iterate over list and subset dataframe columns

storms<-storms[c(-1,-2,-3,-4,-5,-6,-7)]

storms<-lapply(storms, function(x) filter(x, x$Year != "Total"))
storms<-lapply(storms, function(x) x[!(names(x) %in% c("Retired names", "Major landfall hurricanes","Number oftropical cyclones", "Notes", "Strongeststorm"))])

# Convert Year column to character type and rename columns as appropriate

storms <- lapply(storms, function(x) {x$Year <- as.character(x$Year);x})

storms<- lapply(storms, function(x) {colnames(x)[2] <- 'Number_Tropical_Storms'; x})
storms<- lapply(storms, function(x) {colnames(x)[3] <- 'Number_Hurricanes'; x}) 
storms<- lapply(storms, function(x) {colnames(x)[4] <- 'Number_Major_Hurricanes'; x})
storms<- lapply(storms, function(x) {colnames(x)[5] <- 'Accumulated_Cyclone_Energy'; x})
storms<- lapply(storms, function(x) {colnames(x)[7] <- 'Damage_USD'; x})

# Combine list elements to create a single dataframe 

storms<-purrr::map_dfr(storms[], dplyr::bind_rows)

# clean/rename Deaths col and change type to integer

storms<-storms%>%
  mutate(Deaths, Deaths=sub("None", "0", Deaths))%>%
  mutate(Deaths, Deaths=sub("Unknown", "", Deaths))%>%
  mutate(Deaths, Deaths=sub("\\+", "", Deaths))%>%
  mutate(Deaths, Deaths=sub(",", "", Deaths))%>%
  mutate(Deaths, Deaths=sub(">", "", Deaths))%>%
  mutate(Deaths, Deaths=sub("~", "", Deaths))%>%
  rename(Min_Known_Deaths = Deaths) 

storms$Min_Known_Deaths <- as.integer(storms$Min_Known_Deaths)


# clean Damage_USD column and convert to type integer

storms<-storms%>%
  mutate(Damage_USD, Damage_USD=sub("\\$", "",  Damage_USD))%>%
  mutate(Damage_USD, Damage_USD=sub("\\.", "", Damage_USD))%>%
  mutate(Damage_USD, Damage_USD=sub("\\smillion", "000000", Damage_USD))%>%
  mutate(Damage_USD, Damage_USD=sub("\\sbillion", "000000000",  Damage_USD))%>%
  mutate(Damage_USD, Damage_USD=sub(">|\\+|,", "",  Damage_USD))%>%
  mutate(Damage_USD = str_extract_all(Damage_USD, "\\d+"))

storms$Damage_USD<-as.integer(storms$Damage_USD)

# Calculate Summary Statistics 

summary(storms)

# Plot storms counts over time 

num <- storms%>%select(Year, Number_Hurricanes, Number_Major_Hurricanes)%>%
  rename(Hurricanes = Number_Hurricanes, Major_Hurricanes=
    Number_Major_Hurricanes)%>%
    pivot_longer(cols=-c(Year), names_to = "Storm_Type", values_to=
    "Storm_Number")

num%>%ggplot(aes(x = Year, y = Storm_Number, group = Storm_Type, color=
    Storm_Type))+
    geom_line()+
    scale_x_discrete(breaks=c("1900","1920", "1940", "1960",
    "1980","2000","2020"))+
    theme_bw()+
    theme(axis.title.x = element_text(size=14))+
    theme(axis.title.y = element_text(size=14))+
    labs(y="Number of Storms", x = "Year")+
    labs(color = "Storm Type")+
    ggtitle("Annual Count of Atlantic Storms Since 1900")+
    theme(plot.title = element_text(hjust = 0.5))

View(storms)

# Compare accumulated storm energy from 1900-Present

ace <- storms%>%select(Year, Accumulated_Cyclone_Energy)
    
ace%>%ggplot(aes(x = Year, y = Accumulated_Cyclone_Energy))+
    geom_point()+
    scale_x_discrete(breaks=c("1900","1920", "1940", "1960", "1980",
    "2000","2020"))+
    geom_hline(yintercept = 152.5, linetype="solid", label= "Extremely Active
    Season", color = "light blue", size=1.0)+
    geom_vline(xintercept = "2005", linetype="dotted", color = "red",
    size=0.75)+
    theme_bw()+
    theme(axis.title.x = element_text(size=11))+
    theme(axis.title.y = element_text(size=11))+
    labs(y="ACE (kt)", x = "Year", title = "Annual Accumulated Energy of
    Atlantic Storms Since 1900", subtitle = "Reported in Square Knots (kt)")+
    theme(plot.title = element_text(hjust = 0.5))+
    theme(plot.subtitle=element_text(size=11, hjust=0.5, face="italic",
    color="black"))

# Compare storm related deaths vs. accumulated storm energy by year

ace_death<-storms

ace_death%>%ggplot(aes(Accumulated_Cyclone_Energy, Min_Known_Deaths))+
    geom_point()+
    theme_bw()+
    theme(axis.title.x = element_text(size=10))+
    theme(axis.title.y = element_text(size=10))+
    labs(y="Documented Deaths (Minimum Count)", x = "Accumulated
    Cyclone Energy (kt)", title = "Storm Related Deaths vs. Cumulative Storm
    Intensity: 1900 to Present")+
    theme(plot.title = element_text(hjust = 0.5))

# Compare total storm damage vs. accumulated storm energy by year

ace_damage<-storms

ace_damage%>%ggplot(aes(Accumulated_Cyclone_Energy, Damage_USD))+
    geom_point()+
    theme_bw()+
    theme(axis.title.x = element_text(size=10))+
    theme(axis.title.y = element_text(size=10))+
    labs(y="Storm Damage (USD)", x = "Accumulated
    Cyclone Energy (kt)", title = "Total Storm Damage vs. Cumulative Storm
    Intensity: 1900 to Present")+
    theme(plot.title = element_text(hjust = 0.5))




```
## 1. Wikipedia Tables: Results 

Will work on this before we meet.
